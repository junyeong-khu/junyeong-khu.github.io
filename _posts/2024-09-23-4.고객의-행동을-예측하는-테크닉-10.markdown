---
layout: post
title: "íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100 : 4. ê³ ê°ì˜ í–‰ë™ì„ ì˜ˆì¸¡í•˜ëŠ” í…Œí¬ë‹‰ 10"
date: 2024-09-24 03:01:45 +0900
categories: íŒŒì´ì¬_ë°ì´í„°ë¶„ì„_ì‹¤ë¬´_í…Œí¬ë‹‰_100
---
## <span style= 'background-color: #f1f8ff'>4-0: ì „ì œì¡°ê±´
ğŸ’¡ ê³„ì†í•´ì„œ ìŠ¤í¬ì¸  ì„¼í„°ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.\
3ì¥ì—ì„œ ì´ìš© ì´ë ¥ì„ ì§‘ê³„í•œ ê²°ê³¼ì— ê³ ê° ë°ì´í„°ë¥¼ ê²°í•©í•œ customer_join.csvê°€ ì¶”ê°€ëìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” 5ê°œì˜ ë°ì´í„° ì¤‘ì—ì„œ use_log.csvì™€ customer_join.csvë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
![image](https://github.com/user-attachments/assets/09c19024-cebb-44a3-a591-f0109e9088a4)

## <span style= 'background-color: #f1f8ff'>4-1: ë°ì´í„°ë¥¼ ì½ì–´ ë“¤ì´ê³  í™•ì¸í•˜ì
ğŸ—ƒï¸ ë°ì´í„° ë¦¬ë”©: pandasì˜ read_csv()ë¥¼ í†µí•œ ë°ì´í„° ë¦¬ë”© ë° isnull().sum()ì„ í†µí•œ ê²°ì¸¡ì¹˜ íŒŒì•…. ì•ì—ì„œ ì—¬ëŸ¬ ë²ˆ ë‹¤ë£¬ ë‚´ìš©ì´ê¸°ì— ìƒëµ. 3ì¥ì—ì„œì™€ ë§ˆì°¬ê°€ì§€ë¡œ end_date ì´ì™¸ì—ëŠ” ê²°ì¸¡ì¹˜ê°€ 0.

ğŸ” ë¹„ì§€ë„í•™ìŠµ: ì •ë‹µ ë°ì´í„°ë¥¼ í•™ìŠµì‹œí‚¤ì§€ ì•Šê³  ì£¼ì–´ì§„ ë°ì´í„°ë¡œë¶€í„° ê·œì¹™ì„±ê³¼ ê°™ì€ ì˜ë¯¸ ìˆëŠ” ì •ë³´ë¥¼ ë°œê²¬í•˜ëŠ” ë°©ë²•.

ğŸ” í´ëŸ¬ìŠ¤í„°ë§: ë°ì´í„° í¬ì¸íŠ¸ì˜ ê·¸ë£¹í™”ì™€ ê´€ë ¨ëœ ë¨¸ì‹ ëŸ¬ë‹ ê¸°ìˆ .

## <span style= 'background-color: #f1f8ff'>4-2: í´ëŸ¬ìŠ¤í„°ë§ìœ¼ë¡œ íšŒì›ì„ ê·¸ë£¹í™”í•˜ì
ğŸ—ƒï¸ í´ëŸ¬ìŠ¤í„°ë§: ê³ ê°ì˜ í•œ ë‹¬ ì´ìš© ì´ë ¥ ë°ì´í„°ì¸ mean, median, max, min, membership_periodë¥¼ ì´ìš©. ë³€ìˆ˜ ê°„ì˜ ê±°ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·¸ë£¹í™”ë¥¼ ì§„í–‰í•˜ëŠ” K-meansë¥¼ ì´ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ë§.
```python
customer_clustering = customer[["mean", "median", "max", "min", "membership_period"]] #í•„ìš”í•œ ë³€ìˆ˜ ì¶”ì¶œ.

from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
sc = StandardScaler()
customer_clustering_sc = sc.fit_transform(customer_clustering) #í‘œì¤€í™”

kmeans = KMeans(n_clusters=4, random_state=0)
clusters = kmeans.fit(customer_clustering_sc)
customer_clustering["cluster"] = clusters.labels_ #ê° ë°ì´í„° í¬ì¸íŠ¸ì˜ í´ëŸ¬ìŠ¤í„° ë¼ë²¨ì„ ë°ì´í„° í”„ë ˆì„ì— ì¶”ê°€.
print(customer_clustering["cluster"].unique()) #í´ëŸ¬ìŠ¤í„° ë¼ë²¨ì˜ ê³ ìœ ê°’ ì¶œë ¥. 0~3ì˜ ê°’ì„ ê°€ì§.
customer_clustering.head()
```
![image](https://github.com/user-attachments/assets/bf2210bc-79ba-4e85-a94a-865786967a48)

## <span style= 'background-color: #f1f8ff'>4-3: í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì
ğŸ—ƒï¸ ì¹¼ëŸ¼ëª… ë³€ê²½ ë° ë°ì´í„° ìˆ˜ ê³„ì‚°
```python
customer_clustering.columns = ["ì›”í‰ê· ê°’","ì›”ì¤‘ì•™ê°’","ì›”ìµœëŒ“ê°’","ì›”ìµœì†Ÿê°’","íšŒì›ê¸°ê°„","cluster"]
customer_clustering.groupby("cluster").count()
```
![image](https://github.com/user-attachments/assets/55f42264-a340-44e4-91d6-04210c11c902)

ğŸ” ê·¸ë£¹ 0ì´ ê°€ì¥ ë§ê³  ì´í›„ ê·¸ë£¹ 3, ê·¸ë£¹ 2, ê·¸ë£¹ 1ì˜ ìˆœì„œë¡œ ë§ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ.

ğŸ—ƒï¸ í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ ë¶„ì„
```python
customer_clustering.groupby("cluster").mean()
```
![image](https://github.com/user-attachments/assets/ca20e19b-9e44-42ea-b161-fc18a6904087)

1. ê·¸ë£¹ 2ëŠ” íšŒì› ê¸°ê°„ì´ ì§§ì§€ë§Œ, ì´ìš©ë¥ ì´ ë†’ìŒ.
2. ê·¸ë£¹ 1ì€ íšŒì› ê¸°ê°„ì´ ì§§ê³  ê°€ì¥ ì´ìš©ë¥ ì´ ë‚®ìŒ.
3. ê·¸ë£¹ 3ê³¼ ê·¸ë£¹ 0ì€ ê·¸ë£¹ 1, ê·¸ë£¹ 2ë³´ë‹¤ íšŒì› ê¸°ê°„ì´ ê¸º.
4. ê·¸ë£¹ 3ì€ íšŒì› ê¸°ê°„ì€ ê¸¸ì§€ë§Œ ì´ìš©ë¥ ì´ ì•½ê°„ ë‚®ìŒ.

## <span style= 'background-color: #f1f8ff'>4-4: í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ë¥¼ ê°€ì‹œí™”í•˜ì
ğŸ” ì°¨ì› ì¶•ì†Œ: ë¹„ì§€ë„ í•™ìŠµì˜ ì¼ì¢…ìœ¼ë¡œ, ì •ë³´ë¥¼ ë˜ë„ë¡ ìƒì§€ ì•Šê²Œ í•˜ë©´ì„œ ìƒˆë¡œìš´ ì¶•ì„ ë§Œë“œëŠ” ê²ƒ.\
ğŸ” ì£¼ì„±ë¶„ ë¶„ì„: ì°¨ì› ì¶•ì†Œì˜ ëŒ€í‘œì ì¸ ë°©ë²•.

ğŸ—ƒï¸ í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ ê°€ì‹œí™”
```python
from sklearn.decomposition import PCA
X = customer_clustering_sc
pca = PCA(n_components=2)
pca.fit(X)
x_pca = pca.transform(X)
pca_df = pd.DataFrame(x_pca)
pca_df["cluster"] = customer_clustering["cluster"]

import matplotlib.pyplot as plt
%matplotlib inline
for i in customer_clustering["cluster"].unique():
    tmp = pca_df.loc[pca_df["cluster"]==i]
    plt.scatter(tmp[0], tmp[1])
```
![image](https://github.com/user-attachments/assets/dc4aa704-e479-4639-883d-6efa324b16ce)

ğŸ” ê·¸ë˜í”„ì˜ ìƒ‰ì´ ê¹¨ë—í•˜ê²Œ ë‚˜ëˆ„ì–´ì§„ ê²ƒìœ¼ë¡œ ë³´ì•„ ì •ë³´ë¥¼ ë³´ì¡´í•œ ì±„ ê¹”ë”í•˜ê²Œ ì¶•ì†Œëë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ.

## <span style= 'background-color: #f1f8ff'>4-5: í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ íƒˆí‡´ íšŒì›ì˜ ê²½í–¥ì„ íŒŒì•…í•˜ì
ğŸ—ƒï¸ íƒˆí‡´ íšŒì› íŠ¹ì •: is_deleted ì—´ì„ ì¶”ê°€í•˜ì—¬ í•´ë‹¹ ì—´ì„ ê¸°ì¤€ìœ¼ë¡œ êµ¬ë¶„.
```python
customer_clustering = pd.concat([customer_clustering, customer], axis=1) #ì¸ë±ìŠ¤ë¡œ ì—°ê²°ëœ ê²½ìš° concatìœ¼ë¡œ ê²°í•© ê°€ëŠ¥.
customer_clustering.groupby(["cluster","is_deleted"],as_index=False).count()[["cluster","is_deleted","customer_id"]]
```
![image](https://github.com/user-attachments/assets/d94db1fc-aadf-49a8-8e5d-116300b355fa)

ğŸ” ê²°ê³¼ ë¶„ì„: ê·¸ë£¹ 0ì€ ê³¨ê³ ë£¨ í¬í•¨, ê·¸ë£¹ 1ì€ íƒˆí‡´íšŒì›ë§Œ ìˆê³  ê·¸ë£¹ 2ì™€ ê·¸ë£¹ 3ì€ ì§€ì† íšŒì›ì´ ë§ìŒ. ì•ì„  ì§‘ê³„ ê²°ê³¼ê¹Œì§€ ê³ ë ¤í•˜ë©´ ê·¸ë£¹ 2ëŠ” íšŒì› ê¸°ê°„ì´ ì§§ì§€ë§Œ ì´ˆê¸°ì— ì „ì²´ì ìœ¼ë¡œ ì´ìš©ë¥ ì´ ë†’ìœ¼ë©°, ê·¸ë£¹ 3ì€ íšŒì› ê¸°ê°„ì´ ê¸¸ê³  ì´ìš©ë¥ ì´ ê·¸ë£¹ 2ë³´ë‹¤ ë‚®ì§€ë§Œ ì§€ì† íšŒì›ì´ ë§ì€ ì•ˆì •ì ì¸ ê·¸ë£¹ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ.

ğŸ—ƒï¸ ì •ê¸°ì  ì´ìš© ì—¬ë¶€ í™•ì¸
```python
customer_clustering.groupby(["cluster","routine_flg"],as_index=False).count()[["cluster","routine_flg","customer_id"]]
```
![image](https://github.com/user-attachments/assets/3cd8964c-2fd1-4735-9c0e-c87035c25248)

ğŸ” ì§€ì† íšŒì›ì´ ë§ì€ ê·¸ë£¹ 0, ê·¸ë£¹ 3ì—ëŠ” ì •ê¸°ì ìœ¼ë¡œ ì´ìš©í•˜ëŠ” íšŒì›ì´ ë§ìŒ.

## <span style= 'background-color: #f1f8ff'>4-6: ë‹¤ìŒ ë‹¬ì˜ ì´ìš© íšŸìˆ˜ ì˜ˆì¸¡ì„ ìœ„í•´ ë°ì´í„°ë¥¼ ì¤€ë¹„í•˜ì
ğŸ” ê³ ê°ì˜ ê³¼ê±° í–‰ë™ ë°ì´í„°ë¡œë¶€í„° ë‹¤ìŒ ë‹¬ì˜ ì´ìš© íšŸìˆ˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê²½ìš°ì—ëŠ” ì§€ë„í•™ìŠµì˜ **íšŒê·€ ë¶„ì„**ì„ ì´ìš©. ì´ë²ˆì— ì˜ˆì¸¡í•˜ê³  ì‹¶ì€ ì´ìš© íšŸìˆ˜ë„ ìˆ«ì ë°ì´í„°ì´ê¸° ë•Œë¬¸ì— íšŒê·€ë¶„ì„ì´ ê°€ëŠ¥.

ğŸ” ê° íšŒì›ì˜ í–‰ë™ ë°ì´í„°ë¥¼ ì´ìš©í•´ í•™ìŠµí•´ì•¼ í•˜ê¸°ì— íŠ¹ì • ê³ ê°ì˜ íŠ¹ì • ì›”ë³„ ë°ì´í„°ë¥¼ ì‘ì„±í•´ì•¼ í•¨.

ğŸ—ƒï¸ ì—°ì›”, íšŒì›ë³„ ë°ì´í„° ì§‘ê³„
```python
uselog["usedate"] = pd.to_datetime(uselog["usedate"])
uselog["ì—°ì›”"] = uselog["usedate"].dt.strftime("%Y%m")
uselog_months = uselog.groupby(["ì—°ì›”","customer_id"],as_index=False).count()
uselog_months.rename(columns=("log_id":"count"), inplace=True)
del uselog_months["usedate"]
uselog_months.head()
```

ğŸ—ƒï¸ 5ê°œì›”ë¶„ì˜ ì´ìš© íšŸìˆ˜ì™€ ë‹¤ìŒë‹¬ ì´ìš© íšŸìˆ˜ ì €ì¥
```python
year_months = list(uselog_months["ì—°ì›”"].unique())
predict_data = pd.DataFrame()
for i in range(6, len(year_months)):
    tmp = uselog_months.loc[uselog_months["ì—°ì›”"]==year_months[i]]
    tmp.rename(columns={"count":"count_pred"}, inplace=True)
    for j in range(1, 7):
        tmp_before = uselog_months.loc[uselog_months["ì—°ì›”"]==year_months[i-j]]
        del tmp_before["ì—°ì›”"]
        tmp_before.rename(columns={"count":"count_{}".format(j-1)}, inplace=True)
        tmp = pd.merge(tmp, tmp_before, on="customer_id", how="left")
    predict_data = pd.concat([predict_data, tmp], ignore_index=True)
predict_data.head()
```
![image](https://github.com/user-attachments/assets/93f4c971-ee66-430c-a6f7-59bf24502d74)

ğŸ—ƒï¸ ê²°ì¸¡ì¹˜ ì œê±°: ê°€ì… ê¸°ê°„ì´ ì§§ì•„ì„œ ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íšŒì›ì˜ ê¸°ê°„ì„ 6ê°œì›” ì´ìƒ ì¬ì  ì¤‘ì¸ ê²ƒìœ¼ë¡œ ë³€ê²½.
```python
predict_data = predict_data.dropna()
predict_data = predict_data.reset_index(drop=True)
predict_data.head()
```

## <span style= 'background-color: #f1f8ff'>4-7: íŠ¹ì§•ì´ ë˜ëŠ” ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì
ğŸ” íšŒì› ê¸°ê°„ì€ ì‹œê³„ì—´ ë³€í™”ë¥¼ ë³¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ ë°ì´í„°ê°€ ì‹œê³„ì—´ ë°ì´í„°ì¸ ì´ë²ˆ ê²½ìš°ì— ì¶”ê°€í•˜ë©´ ìœ íš¨í•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ.

ğŸ—ƒï¸ start_date ì¹¼ëŸ¼ ì¶”ê°€
```python
predict_data = pd.merge(predict_data, customer[["customer_id", "start_date"]], on = "customer_id", how="left")
predict_data.head()
```
![image](https://github.com/user-attachments/assets/267f4a1b-f7f3-42bb-9b48-b6f067a96171)

ğŸ—ƒï¸ íšŒì› ê¸°ê°„ ì›” ë‹¨ìœ„ ì‘ì„±
```python
predict_data["now_date"] = pd.to_datetime(predict_data["ì—°ì›”"], format="%Y%m")
predict_data["start_date"] = pd.to_datetime(predict_date["start_date"])
from dateutil.relativedelta import relativedelta
predict_data["period"] = None
for i in range(len(predict_data)):
    delta = relativedelta(predict_data["now_date"][i], predict_data["start_date"][i])
    predict_data["period"][i] = delta.years*12 + delta.months
    predict_data.head()
```
![image](https://github.com/user-attachments/assets/af00daff-0ead-4d27-83b8-68c46e8c1d6b)

## <span style= 'background-color: #f1f8ff'>4-8: ë‹¤ìŒ ë‹¬ ì´ìš© íšŸìˆ˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì„ êµ¬ì¶•í•˜ì
ğŸ” ì˜¤ë˜ëœ íšŒì›ì€ ê°€ì… ì‹œê¸° ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì´ìš© íšŸìˆ˜ê°€ ì•ˆì •ì ì¼ ê°€ëŠ¥ì„±ì´ ìˆê¸° ë•Œë¬¸ì— ì˜¤ë˜ëœ íšŒì›ì€ ë¹¼ê³  ëª¨ë¸ì„ êµ¬ì¶•.

ğŸ—ƒï¸ ì„ í˜•íšŒê·€ ëª¨ë¸ êµ¬ì¶•
```python
predict_data = predict_data.loc[predict_data["start_date"]>=pd.to_datetime("20180401")]
from sklearn import linear_model
import sklearn.model_selection
model = linear_model.LinearRegression()
X = predict_data[["count_0","count_1","count_2","count_3","count_4","count_5","period"]]
y = predict_data["count_pred"]
X_train, X_test, y_train, y_test = sklearn.model_selection.train_test_split(X,y)
model.fit(X_train, y_train)
```

ğŸ—ƒï¸ ì •í™•ë„ ê²€ì¦
```python
print(model.score(X_train, y_train))
print(model.score(X_test, y_test))
```
0.5999081481174675\
0.6303741069404682

## <span style= 'background-color: #f1f8ff'>4-9: ëª¨ë¸ì— ê¸°ì—¬í•˜ëŠ” ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì
ğŸ” ì •í™•ë„ê°€ ë†’ì€ ëª¨ë¸ì´ë¼ë„ ì„¤ëª…ì´ ë¶ˆê°€ëŠ¥í•˜ë©´ ì˜ë¯¸ ì—†ìŒ! ì„¤ëª…ì´ ê°€ëŠ¥í•´ì•¼ í•˜ê¸°ì— ëª¨ë¸ì— ê¸°ì—¬í•˜ê³  ìˆëŠ” ë³€ìˆ˜ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”!

ğŸ—ƒï¸ ì„¤ëª… ë³€ìˆ˜ë§ˆë‹¤ ê¸°ì—¬í•˜ëŠ” ê³„ìˆ˜ ì¶œë ¥
```python
coef = pd.DataFrame({"feature_names":X.columns, "coefficient":model.coef_})
coef
```
![image](https://github.com/user-attachments/assets/813b28f9-c4e1-4e6d-9c1e-9dc79dc5a4a2)

ğŸ” count_0ê°€ ê°€ì¥ í¬ê³ , ê³¼ê±°ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°ˆìˆ˜ë¡ ê¸°ì—¬ë„ê°€ ì‘ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆìŒ => ì´ì „ ë‹¬ì˜ ì´ìš© íšŸìˆ˜ê°€ ë‹¤ìŒ ë‹¬ì˜ ì´ìš© íšŸìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆìŒ.

## <span style= 'background-color: #f1f8ff'>4-10: ë‹¤ìŒ ë‹¬ì˜ ì´ìš© íšŸìˆ˜ë¥¼ ì˜ˆì¸¡í•˜ì
ğŸ—ƒï¸ ë‹¤ìŒ ë‹¬ ì´ìš© íšŸìˆ˜ ì˜ˆì¸¡
```python
x1 = [3, 4, 4, 6, 8, 7, 8]
x2 = [2, 2, 3, 3, 4, 6, 8]
x_pred = [x1, x2]

model.predict(x_pred)
```
array([3.8134916, 1.98185194])


### ì¶œì²˜ : íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100