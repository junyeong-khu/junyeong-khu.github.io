---
layout: post
title: "íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100 : 3. ê³ ê°ì˜ ì „ì²´ ëª¨ìŠµì„ íŒŒì•…í•˜ëŠ” í…Œí¬ë‹‰ 10"
date: 2024-09-17 03:01:45 +0900
categories: íŒŒì´ì¬_ë°ì´í„°ë¶„ì„_ì‹¤ë¬´_í…Œí¬ë‹‰_100
---
## <span style= 'background-color: #f1f8ff'>3-0: ì „ì œì¡°ê±´
ğŸ’¡ ì§€ê¸ˆë¶€í„°ëŠ” 30ê°œì˜ í…Œí¬ë‹‰ì„ ì´ìš©í•´ì„œ ìŠ¤í¬ì¸  ì„¼í„°ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.\
ìŠ¤í¬ì¸  ì„¼í„°ì—ëŠ” ì„¼í„°ë¥¼ ì–¸ì œë“  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¢…ì¼ íšŒì›, ë‚®ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì£¼ê°„íšŒì›, ë°¤ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•¼ê°„íšŒì›ìœ¼ë¡œ 3ì¢…ë¥˜ì˜ íšŒì› êµ¬ë¶„ì´ ìˆìŠµë‹ˆë‹¤. ë˜, ì¼ë°˜ì ìœ¼ë¡œ ì…íšŒë¹„ê°€ ë“¤ì§€ë§Œ, ë¹„ì •ê¸°ì ìœ¼ë¡œ ì…íšŒë¹„ ë°˜ì•¡ í• ì¸ì´ë‚˜ ì…íšŒë¹„ ë¬´ë£Œ í–‰ì‚¬ë¥¼ í•´ì„œ ì‹ ê·œíšŒì›ì„ ëŠ˜ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. íƒˆí‡´í•˜ë ¤ë©´ ì›”ë§ê¹Œì§€ ì‹ ì²­í•˜ë©´ ê·¸ ë‹¤ìŒ ë‹¬ ë§ì— íƒˆí‡´ê°€ ë©ë‹ˆë‹¤.\
ì·¨ê¸‰í•  ë°ì´í„°ëŠ” 4ì¢…ë¥˜ì´ë©° í‘œë¡œ ë‚˜íƒ€ëƒˆìŠµë‹ˆë‹¤.\
use_log.csvëŠ” ì„¼í„° ì´ìš© ì´ë ¥ìœ¼ë¡œ, íšŒì›ì´ ì„¼í„°ë¥¼ ì´ìš©í•˜ë©´ ì´ìš©ì¼ì´ ì‹œìŠ¤í…œì— ìë™ ì…ë ¥ë©ë‹ˆë‹¤. 2018ë…„ 4ì›”ë¶€í„° 2019ë…„ 3ì›”ê¹Œì§€ 1ë…„ë¶„ì˜ ë°ì´í„°ì…ë‹ˆë‹¤. customer_master.csvëŠ” 2019ë…„ 3ì›” ë§ ì‹œì ì˜ íšŒì› ë°ì´í„°ì´ë©°, ì´ì „ì— íƒˆí‡´í•œ íšŒì›ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. class_master.csvì™€ campaign_master.csvëŠ” ê°ê° íšŒì› êµ¬ë¶„, ê°€ì… ì‹œ í–‰ì‚¬ ì¢…ë¥˜ ë°ì´í„°ì…ë‹ˆë‹¤.
![image](https://github.com/user-attachments/assets/2481a437-8a50-42af-9e28-969e3c35c747)

## <span style= 'background-color: #f1f8ff'>3-1: ë°ì´í„°ë¥¼ ì½ì–´ ë“¤ì´ê³  í™•ì¸í•˜ì
ğŸ—ƒï¸ ë°ì´í„° ë¦¬ë”©: pandasì˜ read_csv()ë¥¼ í†µí•œ ë°ì´í„° ë¦¬ë”© ë° len()ì„ í†µí•œ ë°ì´í„° ê°œìˆ˜ í™•ì¸ ê³¼ì •. ì•ì—ì„œ ì—¬ëŸ¬ ë²ˆ ë‹¤ë£¬ ë‚´ìš©ì´ê¸°ì— ìƒëµ.

ğŸ” ë³¸ê²©ì ì¸ ë¶„ì„ ì „, head()ë¥¼ ì´ìš©í•˜ì—¬ ê° ë°ì´í„° íŒŒì¼ì˜ ì²˜ìŒ ëª‡ í–‰ì„ í‘œì‹œí•˜ì—¬ ì–´ë–¤ ë°ì´í„°ì—´ì´ ì¡´ì¬í•˜ëŠ”ì§€ì™€ ê° ë°ì´í„° ì‚¬ì´ì˜ ê´€ê³„ì„± ë“±ì„ íŒŒì•…í•˜ëŠ” ê²ƒì´ ì¤‘ìš”.

## <span style= 'background-color: #f1f8ff'>3-2: ê³ ê° ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì
ğŸ—ƒï¸ ë°ì´í„° ì¡°ì¸: customerë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ class_masterì™€ campaign_masterë¥¼ ê²°í•©. ê³µí†µë˜ëŠ” ì—´ì„ ì°¾ì•„ ë ˆí”„íŠ¸ ì¡°ì¸.
```python
customer_join = pd.merge(customer, class_master, on="class", how="left")
customer_join = pd.merge(customer_join, campaign_master, on="campaign_id", how="left")

print(len(customer))
print(len(customer_join))
```
4192\
4192

ğŸ—ƒï¸ ê²°ì¸¡ì¹˜ í™•ì¸: ì¡°ì¸í•  ë•Œ í‚¤ê°€ ì—†ê±°ë‚˜ ì¡°ì¸ì´ ì˜ëª»ë˜ë©´ ìë™ìœ¼ë¡œ ê²°ì¸¡ì¹˜ê°€ ë“¤ì–´ê°. ë”°ë¼ì„œ ì¡°ì¸ í›„ì—ëŠ” ê²°ì¸¡ì¹˜ë¥¼ í™•ì¸í•´ì•¼ í•¨.
```python
customer_join.isnull().sum()
```
![image](https://github.com/user-attachments/assets/95c671ba-6714-41ca-bc69-13c6f49493b7)

ğŸ” end_dateì— ê²°ì¸¡ì´ ìˆëŠ” ì´ìœ ì— ëŒ€í•œ ì¶”ì¸¡: íƒˆí‡´í•˜ì§€ ì•Šì€ íšŒì›ì˜ íƒˆí‡´ì¼ì´ ê³µë°±ì´ê¸° ë•Œë¬¸.

## <span style= 'background-color: #f1f8ff'>3-3: ê³ ê° ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì
ğŸ—ƒï¸ ê³ ê° ë°ì´í„° ì§‘ê³„: ë°ì´í„° ì§‘ê³„ë¥¼ í†µí•´ ì „ë°˜ì ì¸ íŠ¹ì„± íŒŒì•….
```python
customer_join.groupby("class_name").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/6b5a6975-843a-46f2-9c03-974db62164a9)

```python
customer_join.groupby("campaign_name").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/8b8f16a4-6d8c-449e-b32d-da413807c6b5)

```python
customer_join.groupby("gender").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/099d80d2-c914-4022-a7f5-fe06d983ecc6)

```python
customer_join.groupby("is_deleted").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/d309713f-431d-4745-aa09-fff38fabd27c)

## <span style= 'background-color: #f1f8ff'>3-4: ìµœì‹  ê³ ê° ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì
ğŸ—ƒï¸ ìµœì‹  ê³ ê° ë°ì´í„° ì§‘ê³„
```python
customer_join["end_date"] = pd.to_datetime(customer_join["end_date"])
customer_newer = customer_join.loc[(customer_join["end_date"] >= pd.to_datetime("20190331")) | (customer_join["end_date"].isna())]
print(len(customer_newer))
customer_newer["end_date"].unique()
```

âŠ• loc(): íŠ¹ì • í–‰ê³¼ ì—´ ì„ íƒ.

ğŸ—ƒï¸ ì „ì²´ ë°ì´í„°ê° íŒŒì•…
```python
customer_newer.groupby("class_name").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/67234ccc-c7a6-4cfa-be52-b3b10e9953d2)

```python
customer_newer.groupby("campaign_name").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/4c662b34-aaba-4aff-bba5-a7942cf2acf2)

```python
customer_newer.groupby("gender").count()["customer_id"]
```
![image](https://github.com/user-attachments/assets/7ada50d8-8a00-4fa0-9d39-2664d537042a)

ğŸ” íšŒì› êµ¬ë¶„ ë° ì„±ë³„ì„ ì „ì²´ë¥¼ ì§‘ê³„í–ˆì„ ë•Œì™€ ë¹„ìœ¨ì´ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šìœ¼ë‚˜, **ìº í˜ì¸ êµ¬ë¶„ì€ ì•½ê°„ ì°¨ì´ê°€ ìˆì–´ ì…íšŒ ìº í˜ì¸ì€ íšŒì› ë¹„ìœ¨ ë³€í™”ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤ê³  ì¶”ì¸¡í•  ìˆ˜ ìˆìŒ.**

## <span style= 'background-color: #f1f8ff'>3-5: ì´ìš© ì´ë ¥ ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì
ğŸ—ƒï¸ ì´ìš© ì´ë ¥ ë°ì´í„° ì§‘ê³„
```python
uselog["usedate"] = pd.to_datetime(uselog["usedate"])
uselog["ì—°ì›”"] = uselog["usedate"].dt.strftime("%Y%m")
uselog_months = uselog.groupby(["ì—°ì›”","customer_id"],as_index=False).count()
uselog_months.rename(columns={"log_id":"count"}, inplace=True)
del uselog_months["usedate"]
uselog_months.head()
```
![image](https://github.com/user-attachments/assets/018633b5-b11a-45b3-9aae-bcdc2f52feba)

âŠ• as_index=False: ì¸ë±ìŠ¤ë¥¼ ê¸°ë³¸ ì¸ë±ìŠ¤ë¡œ ìœ ì§€.


ğŸ—ƒï¸ ê³ ê°ë³„ í‰ê· ê°’, ì¤‘ì•™ê°’, ìµœëŒ“ê°’, ìµœì†Ÿê°’ ì§‘ê³„
```python
uselog_customer = uselog_months.groupby("customer_id").agg(["mean", "median", "max", "min"])["count"]
uselog_customer = uselog_customer.reset_index(drop=False)
uselog_customer.head()
```
![image](https://github.com/user-attachments/assets/6d4c424c-dc35-462f-abed-ccaa02a67f48)

âŠ• drop=False: ì¸ë±ìŠ¤ë¥¼ ì—´ë¡œ ìƒì„±.

## <span style= 'background-color: #f1f8ff'>3-6: ì´ìš© ì´ë ¥ ë°ì´í„°ë¡œë¶€í„° ì •ê¸° ì´ìš© í”Œë˜ê·¸ë¥¼ ì‘ì„±í•˜ì
ğŸ—ƒï¸ ì •ê¸° ì´ìš© íšŒì›ì˜ í”Œë˜ê·¸ ì‘ì„±: ë§¤ì£¼ ê°™ì€ ìš”ì¼ì— ì™”ëŠ”ì§€ ì•„ë‹Œì§€ë¡œ íŒë‹¨. ê³ ê°ë§ˆë‹¤ ì›”/ìš”ì¼ë³„ë¡œ ì§‘ê³„í•˜ê³ , ìµœëŒ“ê°’ì´ 4 ì´ìƒì¸ ìš”ì¼ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ” íšŒì›ì€ í”Œë˜ê·¸ë¥¼ 1ë¡œ ì²˜ë¦¬.
```python
uselog["weekday"] = uselog["usedate"].dt.weekday
uselog_weekday = uselog.groupby(["customer_id", "ì—°ì›”", "weekday"], as_index = False).count()[["customer_id", "ì—°ì›”", "weekday", "log_id"]]
uselog_weekday.rename(columns=["log_id":"count"], inplace=True)
uselog_weekday.head()
```
![image](https://github.com/user-attachments/assets/63ffdcd8-2c75-4fbe-a0f8-fc1b5056c861)

```python
uselog_weekday = uselog_weekday.groupby("customer_id", as_index=False).max()[["customer_id", "count"]]
uselog_weekday["routine_flg"] = 0
uselog_weekday["routine_flg"] = uselog_weekday["routine_flg"].where(uselog_weekday["count"]<4, 1)
uselog_weekday.head()
```
![image](https://github.com/user-attachments/assets/ccc80b98-8d6d-4d8d-a8db-314a38cb7bfc)

## <span style= 'background-color: #f1f8ff'>3-7: ê³ ê° ë°ì´í„°ì™€ ì´ìš© ì´ë ¥ ë°ì´í„°ë¥¼ ê²°í•©í•˜ì
ğŸ—ƒï¸ ê³ ê° ë°ì´í„°ì™€ ì´ìš© ì´ë ¥ ë°ì´í„° ê²°í•©
```python
customer_join = pd.merge(customer_join, uselog_customer, on="customer_id", how="left")
customer_join = pd.merge(customer_join, uselog_weekday[["customer_id", "routine_flg"]], on="customer_id", how="left")
customer_join.head()
```
![image](https://github.com/user-attachments/assets/fcb4aa9f-dd79-4e14-b2c3-06a298328143)

ğŸ—ƒï¸ ê²°ì¸¡ì¹˜ í™•ì¸: isnull().sum() í™œìš©. ë°ì´í„° ê²°í•©ì‹œ ê²°ì¸¡ì¹˜ í™•ì¸í•˜ëŠ” ê²ƒì„ ìŠµê´€ ë“¤ì¼ ê²ƒ.

## <span style= 'background-color: #f1f8ff'>3-8: íšŒì› ê¸°ê°„ì„ ê³„ì‚°í•˜ì
ğŸ—ƒï¸ íšŒì› ê¸°ê°„ ê³„ì‚°: 2019ë…„ 3ì›”ê¹Œì§€ íƒˆí‡´í•˜ì§€ ì•Šì€ íšŒì›ì€ end_dateë¥¼ 2019ë…„ 4ì›” 30ì¼ë¡œ ì±„ì›Œì„œ íšŒì› ê¸°ê°„ ê³„ì‚°.
```python
from dateutil.relativedelta import relativedelta
customer_join["calc_date"] = customer_join["end_date"]
customer_join["calc_date"] = customer_join["calc_date"].fillna(pd.to_datetime("20190430"))
customer_join["membership_period"] = 0
for i in range(len(customer_join)):
    delta = relativedelta(customer_join["calc_date"].iloc[i], customer_join["start_date"].iloc[i])
    customer_join["membership_period"].iloc[i] = delta.years*12 + delta.months
customer_join.head()
```
![image](https://github.com/user-attachments/assets/1e147aa5-5125-4cce-a090-c6ffe81815db)

âŠ• relativedelta: ë‚ ì§œ ë¹„êµ í•¨ìˆ˜.\
âŠ• iloc[]: í–‰ê³¼ ì—´ì„ ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì„ íƒí•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¸ë±ì‹± ë°©ë²•.

## <span style= 'background-color: #f1f8ff'>3-9: ê³ ê° í–‰ë™ì˜ ê°ì¢… í†µê³„ëŸ‰ì„ íŒŒì•…í•˜ì
ğŸ—ƒï¸ ê°ì¢… í†µê³„ëŸ‰ íŒŒì•…
```python
customer_join[["mean", "median", "max", "min"]].describe()
```
![image](https://github.com/user-attachments/assets/1bce3783-538e-46c0-a1a5-e86bc457cb39)

```python
import matplotlib.pyplot as plt
%matplotlib inline #ì£¼í”¼í„° ë…¸íŠ¸ë¶ì—ì„œ ê·¸ë˜í”„ë¥¼ ì¸ë¼ì¸ìœ¼ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•œ ì»¤ë§¨ë“œ
plt.hist(customer_join["membership_period"])
```
![image](https://github.com/user-attachments/assets/dfe642fd-6b12-4d4b-9971-cdd09a857ea6)

ğŸ” í†µê³„ëŸ‰ íŒŒì•…ì„ í†µí•´ ê³ ê° íŠ¹ì„± íŒŒì•…. ì˜ˆë¥¼ ë“¤ì–´ íšŒì› ê¸°ê°„ì´ 10ê°œì›” ì´ë‚´ì¸ ê³ ê°ì´ ë§ê³ , 10ê°œì›” ì´ìƒì˜ ê³ ê° ìˆ˜ëŠ” ê±°ì˜ ì¼ì •.

## <span style= 'background-color: #f1f8ff'>3-10: íƒˆí‡´ íšŒì›ê³¼ ì§€ì† íšŒì›ì˜ ì°¨ì´ë¥¼ íŒŒì•…í•˜ì
ğŸ—ƒï¸ íƒˆí‡´ íšŒì›ê³¼ ì§€ì† íšŒì› ë¹„êµ
```python
customer_end = customer_join.loc[customer_join["is_deleted"]==1]
customer_end.describe()
```
![image](https://github.com/user-attachments/assets/4d96997d-5ff1-485f-bf18-e849726a0886)

```python
customer_stay = customer_join.loc[customer_join["is_deleted"]==0]
customer_stay.describe()
```
![image](https://github.com/user-attachments/assets/93356b72-85a9-4384-b10c-46fadef50536)

ğŸ” íƒˆí‡´ íšŒì›ì˜ ë§¤ì›” ì´ìš© íšŸìˆ˜ì˜ í‰ê· ê°’, ì¤‘ì•™ê°’, ìµœëŒ“ê°’, ìµœì†Ÿê°’ì€ ëª¨ë‘ ì§€ì† íšŒì›ë³´ë‹¤ ì‘ìŒ. routine_flgì˜ í‰ê· ê°’ì€ íŠ¹íˆ ì°¨ì´ê°€ í¬ê²Œ ë‚˜ì„œ ì§€ì† íšŒì›ì€ 0.98ë¡œ ë§ì€ íšŒì›ì´ ì •ê¸°ì ìœ¼ë¡œ ì´ìš©í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì§€ë§Œ, íƒˆí‡´ íšŒì›ì€ 0.45ë¡œ ê±°ì˜ ì ˆë°˜ì€ ëœë¤í•˜ê²Œ ì´ìš©í•˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ.

ğŸ—ƒï¸ csv íŒŒì¼ë¡œ ë³€í™˜
```python
customer_join.to_csv("customer_join.csv", index=False)
```


### ì¶œì²˜ : íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100